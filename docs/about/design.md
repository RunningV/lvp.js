# 设计

## 设计理念

Lvp的核心逻辑非常简单，它不依赖任何其它库，所以它的包体积非常小。

小而不凡，Lvp拥有完善的边缘检测机制。

Lvp的目标是解决业务上的问题。所以 Lvp的核心不是在编程层面，而更加偏向业务层面。Lvp内置方法列表中不会有类似 isDate, isNumber, isFunction 之类的方法。因为关于这些问题，业界已经有了很多优秀的解决方案。Lvp要解决的更多是业务上的东西，比如对电子邮件，身份证，电话这一类事物的校验。

Lvp不会干预表单或者输入事件，尽管表单校验是 Lvp主要的应用场景之一。Lvp在何时使用，完全由您决定。您也可以扩展原有的校验规则，添加您需要的自定义规则。

Lvp的适用平台非常广泛，支持浏览器、node.js、~~Typescript~~。同时也支持 node.js Common-like 规范、AMD 规范、ESM 规范。与任何框架都不会产生兼容性的问题，比如 React、jQuery、Vue 等。

## 关于组合校验

目前没有计划实现组合校验。无论是组合校验还是嵌套校验，都可以通过摊平的方式变为简单校验，而且组合校验的使用场景并不多见。

## 关于兼容性

为了保证兼容性，源代码使用 ES5 规范编写，最少可以兼容至 IE8。在代码中有检测运行平台的功能，会自动对各大平台进行扩展。并通过工具生成兼容 ES6 的模块文件，这些都会在每次版本更新时自动完成。

## 对比其他解决方案

具有类似功能的库不在少数，比如 validateator.js、moment。或者一些与框架绑定的库，如 React 的 react-hook-form、formsy-react；Vue 的 vuelidate、vee-validate；jQuery 的 jquery-validation 等等。

事实上它们都比现在的 lvp.js 成熟，无论是功能上、代码稳定性上。但是它们或多或少都有些缺点或者说是用起来不那么舒服的地方。lvp.js 并没有把那些库作为对手，也不会抄袭那些库的 API。

上面提到的那些库，lvp.js 的作者几乎都用过。都很好，但作者也认为它们多多少少都有可以变得更好的地方。

## 特点

下面谈谈 lvp.js 的几个特点：

### 1. 配置优先思想

有很多库的实现是这样的链式调用。

```js
var price = 12;
validator
  .test(price)
  .required()
  .min(8)
  .max(60);
```

实际上 lvp.js 在刚开发阶段也尝试这么做过，面临的问题是在自定义扩展校验函数时不好处理。但仍有至少两种解决方案。

第一种方案是用方括号`[]`调用的方式，继续拿上面的伪代码演示。

```js
validator
  .test(price)
  .required()
  .min(8)
  .max(60)
  ["isDiscount"]();
```

这种方式的最大问题就是一旦用户把这个函数名拼写错误就会导致 js 最高级别的代码错误，会中止后续代码的运行。作为一个库而言，这样的设计是不可取的。

第二种方案是在调用自定义函数前加一个统一的接口来适配，然后在 custom 函数中来处理并正确调用自定义函数。

```js
validator
  .test(price)
  .required()
  .min(8)
  .max(60)
  .custom(["isDiscount"]);
```

虽然这个问题可以解决，但作者仍然认为采用配置的方式是相对来说更优的办法。

链式调用的好处就是简洁优雅，作者甚至想过配置和链式调用共存，但最终仍放弃了链式调用。原因可以继续朝下看。

### 2. 极简 API

lvp.js 的作者曾经写过一篇全面讲解 Js Array 的文章，里面介绍了 Array 的各种 API，官方 30 余种，民间几十种，相信没有几个人能够记清楚每个 API 里面的细节。

繁琐的 API 代表着更强大的功能，但随之而来的是学习成本。

放弃链式调用的原因也在于此。作者认为，数据校验这件事，寥寥几个 API 就能解决，没必要设计出一大堆功能单一但几乎无法单独使用或者使用率极低的 API。设计是好的，但是为了设计而设计，反而是不好的。可以想想 express 和 koa。

lvp.js 仍然有很多 API，这是一个作为数据校验库不能避开的问题。但核心 API 很少，其他都是用于校验数据的 API。您可以直接在官网的 API 上面搜索，然后复制到您的配置对象中。当您添加了很多自定义的逻辑时，可以访问`lvp.rulesList`来获取规则名称列表。

### 3. 本土化

开发 lvp.js 的最主要的目的，仍然是着眼于解决实际问题。作为一个中国开发者，作者很少能够真正找到关于数据校验方面即开即用的 API，更多时候仍要自己去写正则表达式来校验数据。

lvp.js 中默认附带了大量中国本土化的校验规则，这是其它类库所没有的。其中的校验逻辑经过精密测试，您可以放心使用。这也算是 lvp.js 目前来说最大的优点。
